# Generated by: xandri03

# $0 - framepointer
# $1 - function return value
ALIAS FP $0
# $7 - table of VMTs
CREATE $7 3
# fill it with individual VMTs
CREATE $6 4
SETWORD $7 1 $6
SETWORD $6 0 "A::getClass"
SETWORD $6 1 "A::toString"
SETWORD $6 2 "A::bar"
SETWORD $6 3 "A::foo"
CREATE $6 4
SETWORD $7 2 $6
SETWORD $6 0 "B::getClass"
SETWORD $6 1 "B::toString"
SETWORD $6 2 "B::bar"
SETWORD $6 3 "B::foo"
CREATE $6 2
SETWORD $7 0 $6
SETWORD $6 0 "Object::getClass"
SETWORD $6 1 "Object::toString"

# call main, exit afterwards
CALL [$SP] ::main
JUMP @exit

# ***** GLOBAL FUNCTIONS *****

# ----------------------
LABEL ::length
SET $FP $SP
ADDI $SP $SP 0

GETSIZE $1 [$FP-1]
SET $SP $FP
RETURN [$FP]

# Hard return
SET $1 0
SET $SP $FP
RETURN [$FP]

# ----------------------
LABEL ::subStr
SET $FP $SP
ADDI $SP $SP 0

GETSIZE $1 [$FP-1]
LTI $2 [$FP-2] 0
EQI $3 [$FP-2] $1
GTI $4 [$FP-2] $1
LTI $5 [$FP-3] 0
OR $2 $2 $3
OR $2 $2 $4
OR $2 $2 $5
JUMPNZ ::subStr:0:return $2
ADDI $2 [$FP-2] [$FP-3]
SUBI $2 $2 $1
GTI $3 $2 0
JUMPZ ::subStr:0:end_if $3
SUBI $2 [$FP-3] $2
SET [$FP-3] $2
LABEL ::subStr:0:end_if
CREATE $1 [$FP-3]
SET $2 [$FP-1]
SET $3 0
LABEL ::subStr:0:while
LTI $4 $3 [$FP-3]
JUMPZ ::subStr:0:end_while $4
SET $4 [$FP-2]
ADDI $4 $4 $3
GETWORD $4 $2 $4
SETWORD $1 $3 $4
ADDI $3 $3 1
JUMP ::subStr:0:while
LABEL ::subStr:0:end_while
SET $SP $FP
RETURN [$FP]
LABEL ::subStr:0:return
SET $1 ""
SET $SP $FP
RETURN [$FP]

# Hard return
SET $1 ""
SET $SP $FP
RETURN [$FP]

# ----------------------
LABEL ::main
SET $FP $SP
ADDI $SP $SP 2


SET [$FP+1] 0

ADDI $SP $SP 1
SET [$SP] $FP
CREATE $1 2
ADDI $SP $SP 1
SET [$SP] $1
ADDI $SP $SP 1
CALL [$SP] Object::Object
SUBI $SP $SP 1
SET $1 [$SP]
SUBI $SP $SP 1
SET $FP [$SP]
SUBI $SP $SP 1
ADDI $SP $SP 1
SET [$SP] $1
SET [$FP+1] [$SP]
SUBI $SP $SP 1

ADDI $SP $SP 1
SET [$SP] [$FP+1]
SET $1 [$SP]
SUBI $SP $SP 1
GETWORD $1 $1 0
GETWORD $1 $1 1
ADDI $SP $SP 1
SET [$SP] $FP
ADDI $SP $SP 1
CALL [$SP] $1
SUBI $SP $SP 1
SET $FP [$SP]
SUBI $SP $SP 1
ADDI $SP $SP 1
SET [$SP] $1
SET $1 [$SP]
SUBI $SP $SP 1
WRITES $1

SET [$FP+2] 0

ADDI $SP $SP 1
SET [$SP] $FP
CREATE $1 3
ADDI $SP $SP 1
SET [$SP] $1
ADDI $SP $SP 1
CALL [$SP] A::A
SUBI $SP $SP 1
SET $1 [$SP]
SUBI $SP $SP 1
SET $FP [$SP]
SUBI $SP $SP 1
ADDI $SP $SP 1
SET [$SP] $1
SET [$FP+2] [$SP]
SUBI $SP $SP 1

ADDI $SP $SP 1
SET [$SP] [$FP+2]
SET $1 [$SP]
SUBI $SP $SP 1
GETWORD $1 $1 0
GETWORD $1 $1 3
ADDI $SP $SP 1
SET [$SP] $FP
ADDI $SP $SP 1
SET [$SP] 42
ADDI $SP $SP 1
CALL [$SP] $1
SUBI $SP $SP 2
SET $FP [$SP]
SUBI $SP $SP 1

ADDI $SP $SP 1
SET [$SP] [$FP+2]
SET $1 [$SP]
SUBI $SP $SP 1
GETWORD $1 $1 0
GETWORD $1 $1 3
ADDI $SP $SP 1
SET [$SP] $FP
ADDI $SP $SP 1
SET [$SP] 42
ADDI $SP $SP 1
CALL [$SP] $1
SUBI $SP $SP 2
SET $FP [$SP]
SUBI $SP $SP 1

SET $1 [$FP+2]
GETWORD $1 $1 2
ADDI $SP $SP 1
SET [$SP] $1
SET $1 [$SP]
SUBI $SP $SP 1
WRITEI $1

# Hard return
SET $SP $FP
RETURN [$FP]


# ***** CLASSES *****

# ----------------------
LABEL A::A
SET $FP $SP
ADDI $SP $SP 0

ADDI $SP $SP 1
SET [$SP] $FP
ADDI $SP $SP 1
SET [$SP] [$FP-1]
ADDI $SP $SP 1
CALL [$SP] Object::Object
SUBI $SP $SP 2
SET $FP [$SP]
SUBI $SP $SP 1
SET $1 [$FP-1]
GETWORD $2 $7 1
SETWORD $1 0 $2
SETWORD $1 2 0

# Hard return
SET $SP $FP
RETURN [$FP]

# ----------------------
LABEL A::foo
SET $FP $SP
ADDI $SP $SP 3


ADDI $SP $SP 1
SET [$SP] 1
SET $1 [$FP+0]
SETWORD $1 2 [$SP]
SUBI $SP $SP 1

SET $1 [$FP+0]
GETWORD $1 $1 2
ADDI $SP $SP 1
SET [$SP] $1
SET $1 [$SP]
SUBI $SP $SP 1
WRITEI $1

# Hard return
SET $1 0
SET $SP $FP
RETURN [$FP]

# ----------------------
LABEL A::bar
SET $FP $SP
ADDI $SP $SP 2


# Hard return
SET $1 0
SET $SP $FP
RETURN [$FP]

# ----------------------
LABEL B::B
SET $FP $SP
ADDI $SP $SP 0

ADDI $SP $SP 1
SET [$SP] $FP
ADDI $SP $SP 1
SET [$SP] [$FP-1]
ADDI $SP $SP 1
CALL [$SP] A::A
SUBI $SP $SP 2
SET $FP [$SP]
SUBI $SP $SP 1
SET $1 [$FP-1]
GETWORD $2 $7 2
SETWORD $1 0 $2

# Hard return
SET $SP $FP
RETURN [$FP]

# ----------------------
LABEL B::foo
SET $FP $SP
ADDI $SP $SP 3


# Hard return
SET $1 0
SET $SP $FP
RETURN [$FP]

# ----------------------
LABEL Object::Object
SET $FP $SP
ADDI $SP $SP 0

SET $1 [$FP-1]
GETWORD $2 $7 0
SETWORD $1 0 $2
SETWORD $1 1 ""

# Hard return
SET $SP $FP
RETURN [$FP]

# ----------------------
LABEL Object::toString
SET $FP $SP
ADDI $SP $SP 1

SET $1 ""
SET $SP $FP
RETURN [$FP]

# Hard return
SET $1 ""
SET $SP $FP
RETURN [$FP]

# ----------------------
LABEL Object::getClass
SET $FP $SP
ADDI $SP $SP 0

SET $1 [$FP-1]
GETWORD $1 $1 0
GETWORD $1 $1 1
SET $SP $FP
RETURN [$FP]

# Hard return
SET $1 ""
SET $SP $FP
RETURN [$FP]


LABEL @exit

